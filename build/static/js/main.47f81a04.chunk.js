(this["webpackJsonptb-admin"]=this["webpackJsonptb-admin"]||[]).push([[0],{470:function(e,t,r){},682:function(e,t,r){"use strict";r.r(t);var n=r(8),a=r(0),c=r.n(a),s=r(20),i=r.n(s),o=(r(470),r(772)),u=r(771),d=r(25),l=r(21),f=r.n(l),b=r(42),p=r(145),h=r(34),j=(r(231),r(290),{userProfilePath:"/admin/",userAdminProp:"is_admin",localStorageTokenName:"RAFirebaseClientToken",handleAuthStateChange:function(){var e=Object(b.a)(f.a.mark((function e(t,r){var n,a,c,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=20;break}return e.next=3,h.a.firestore().doc(r.userProfilePath+t.user.uid).get();case 3:if(n=e.sent,a=n.data(),console.log("gisng",r.userProfilePath+t.user.uid),!a||!a[r.userAdminProp]){e.next=15;break}return e.next=9,t.user.getIdToken();case 9:return c=e.sent,s={auth:t,profile:a,firebaseToken:c},localStorage.setItem(r.localStorageTokenName,c),e.abrupt("return",s);case 15:throw h.a.auth().signOut(),localStorage.removeItem(r.localStorageTokenName),new Error("sign_in_error");case 18:e.next=22;break;case 20:throw localStorage.removeItem(r.localStorageTokenName),new Error("sign_in_error");case 22:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}),m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e=Object(d.a)(Object(d.a)({},j),e);var t=function(){return new Promise((function(e){h.a.auth().onAuthStateChanged(e)}))};return function(){var r=Object(b.a)(f.a.mark((function r(n,a){var c,s,i,o,u;return f.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(n!==p.e){r.next=3;break}return e.handleAuthStateChange(null,e).catch((function(){})),r.abrupt("return",h.a.auth().signOut());case 3:if(!h.a.auth().currentUser){r.next=6;break}return r.next=6,h.a.auth().currentUser.reload();case 6:if(n!==p.a){r.next=12;break}return r.next=9,t();case 9:if(h.a.auth().currentUser){r.next=11;break}throw new Error("sign_in_error");case 11:return r.abrupt("return",!0);case 12:if(n!==p.c){r.next=22;break}return console.log("AUTH_GET_PERMISSIONS"),r.next=16,t();case 16:if(h.a.auth().currentUser){r.next=18;break}throw new Error("sign_in_error");case 18:return r.next=20,h.a.auth().currentUser.getIdTokenResult();case 20:return c=r.sent,r.abrupt("return",c.claims);case 22:if(n!==p.d){r.next=30;break}if(s=a.username,i=a.password,o=a.alreadySignedIn,(u=h.a.auth().currentUser)&&o){r.next=29;break}return r.next=28,h.a.auth().signInWithEmailAndPassword(s,i);case 28:u=r.sent;case 29:return r.abrupt("return",e.handleAuthStateChange(u,e));case 30:return r.abrupt("return",!1);case 31:case"end":return r.stop()}}),r)})));return function(e,t){return r.apply(this,arguments)}}()},x=r(266),O=r(156),g=r(144),w=(r(683),r(361)),v=r.n(w),k=r(63),y=function(e){return new Promise((function(t,r){var n=new FileReader;n.readAsDataURL(e.rawFile),n.onload=function(){return t(n.result)},n.onerror=r}))},_=function(e){return new Promise((function(t){var r=document.createElement("img");r.onload=function(){t({width:this.width,height:this.height})},r.src=e.src}))},S=function(){var e=Object(b.a)(f.a.mark((function e(t,r,n,a,c){var s,i,o,u,d,l,b;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=r[t]){e.next=3;break}return e.abrupt("return",!1);case 3:if(s=Array.isArray(s)?s[0]:s,i=s.rawFile,o={},!(s&&i&&i.name)){e.next=32;break}return u=h.a.storage().ref().child("".concat(c,"/").concat(n,"/").concat(t)),e.next=10,u.put(i);case 10:return d=e.sent,e.next=13,d.ref.getDownloadURL();case 13:if(l=e.sent,o[t]=[{}],o[t][0].uploadedAt=new Date,o[t][0].src=l,o[t][0].type=i.type,o[t][0].name=i.name,0!==i.type.indexOf("image/")){e.next=31;break}return e.prev=20,e.next=23,_(s);case 23:b=e.sent,o[t][0].width=b.width,o[t][0].height=b.height,e.next=31;break;case 28:e.prev=28,e.t0=e.catch(20),console.error("Failed to get image dimensions");case 31:return e.abrupt("return",o);case 32:return e.abrupt("return",!1);case 33:case"end":return e.stop()}}),e,null,[[20,28]])})));return function(t,r,n,a,c){return e.apply(this,arguments)}}(),D=function(){var e=Object(b.a)(f.a.mark((function e(t,r,n,a,c,s,i,o,u){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i&&i.map((function(e){return!!e&&Object.assign(r,e)})),o&&Object.assign(r,Object(O.a)({},u.createdAt,new Date)),(r=Object.assign(n,Object(O.a)({},u.updatedAt,new Date),r)).id||(r.id=t),e.next=6,h.a.firestore().doc("".concat(c,"/").concat(r.id)).set(s(r));case 6:return e.abrupt("return",{data:r});case 7:case"end":return e.stop()}}),e)})));return function(t,r,n,a,c,s,i,o,u){return e.apply(this,arguments)}}(),P=function(){var e=Object(b.a)(f.a.mark((function e(t,r,n,a){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a.length&&a.map((function(e){return h.a.storage().ref().child("".concat(n,"/").concat(t,"/").concat(e)).delete()})),e.next=3,h.a.firestore().doc("".concat(n,"/").concat(t)).delete();case 3:return e.abrupt("return",{data:t});case 4:case"end":return e.stop()}}),e)})));return function(t,r,n,a){return e.apply(this,arguments)}}(),A=function(){var e=Object(b.a)(f.a.mark((function e(t,r,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.map((function(e){return h.a.firestore().doc("".concat(r,"/").concat(e)).delete()}));case 2:return e.abrupt("return",{data:t});case 3:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),I=function(){var e=Object(b.a)(f.a.mark((function e(t,r,n){var a,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.id){e.next=13;break}return e.next=3,h.a.firestore().collection(r).doc(t.id).get();case 3:if(!(a=e.sent).exists){e.next=10;break}return(c=a.data())&&null==c.id&&(c.id=a.id),e.abrupt("return",{data:c});case 10:throw new Error("Id not found");case 11:e.next=14;break;case 13:throw new Error("Id not found");case 14:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),T=function(){var e=Object(b.a)(f.a.mark((function e(t,r,n){var a,c,s,i,o,u,d,l,b,p,j,m,O,g,w;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.pagination){e.next=19;break}return a=[],e.next=4,h.a.firestore().collection(r).get();case 4:c=e.sent,s=Object(x.a)(c.docs);try{for(s.s();!(i=s.n()).done;)o=i.value,(u=o.data())&&null==u.id&&(u.id=o.id),a.push(u)}catch(n){s.e(n)}finally{s.f()}return t.filter&&(a=a.filter((function(e){for(var r=!0,n=0,a=Object.keys(t.filter);n<a.length;n++){var c=a[n];r=e[c]===t.filter[c]}return r}))),t.sort&&a.sort(v()("".concat("ASC"===t.sort.order?"":"-").concat(t.sort.field))),d=a.map((function(e){return e.id})),l=t.pagination,b=l.page,p=l.perPage,j=(b-1)*p,m=b*p,O=a?a.slice(j,m):[],g=d.slice(j,m)||[],w=a?a.length:0,e.abrupt("return",{data:O,ids:g,total:w});case 19:throw new Error("Error processing request");case 20:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),E=function(){var e=Object(b.a)(f.a.mark((function e(t,r,n){var a,c,s,i,o,u;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=[],c=Object(x.a)(t.ids),e.prev=2,c.s();case 4:if((s=c.n()).done){e.next=13;break}return i=s.value,e.next=8,I({id:i},r,n);case 8:o=e.sent,u=o.data,a.push(u);case 11:e.next=4;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(2),c.e(e.t0);case 18:return e.prev=18,c.f(),e.finish(18);case 21:return e.abrupt("return",{data:a});case 22:case"end":return e.stop()}}),e,null,[[2,15,18,21]])})));return function(t,r,n){return e.apply(this,arguments)}}(),F=function(){var e=Object(b.a)(f.a.mark((function e(t,r,n){var a,c,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.target){e.next=11;break}return t.filter||(t.filter={}),t.filter[t.target]=t.id,e.next=5,T(t,r,n);case 5:return a=e.sent,c=a.data,s=a.total,e.abrupt("return",{data:c,total:s});case 11:throw new Error("Error processing request");case 12:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}(),C={upload:S,save:D,del:P,delMany:A,getItemID:function(e,t,r,n,a){var c=e.data.id||e.id||e.data.key||e.key;if(c||(c=h.a.firestore().collection(n).doc().id),!c)throw new Error("ID is required");if(a&&a[c]&&t===k.a)throw new Error("ID already in use");return c},getOne:I,getList:T,getMany:E,getManyReference:F,addUploadFeature:function(e){return function(t,r,n){if("UPDATE"===t&&n.data.image&&n.data.image.length){var a=n.data.image.filter((function(e){return!(e.rawFile instanceof File)})),c=n.data.image.filter((function(e){return e.rawFile instanceof File}));return Promise.all(c.map(y)).then((function(e){return e.map((function(e){return{src:e,title:"".concat(n.data.title)}}))})).then((function(c){return e(t,r,Object(d.a)(Object(d.a)({},n),{},{data:Object(d.a)(Object(d.a)({},n.data),{},{image:[].concat(Object(g.a)(c),Object(g.a)(a))})}))}))}return e(t,r,n)}},convertFileToBase64:y},M={initialQuerytimeout:1e4,timestampFieldNames:{createdAt:"createdAt",updatedAt:"updatedAt"}},N=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t=Object.assign({},M,t),n=r.timestampFieldNames,a=r.trackedResources,c={},s={},i={},o={};0===h.a.apps.length&&(h.a.initializeApp(e),h.a.auth().setPersistence(h.a.auth.Auth.Persistence.SESSION));var u=t.upload||C.upload,d=t.save||C.save,l=t.del||C.del,p=t.getItemID||C.getItemID,j=t.getOne||C.getOne,m=t.getMany||C.getMany,x=t.getManyReference||C.getManyReference,O=t.delMany||C.delMany,g=t.getList||C.getList,w=t.firebaseSaveFilter?t.firebaseSaveFilter:function(e){return e};return a.map((function(e,t){typeof e===Array&&(e={name:e.name,path:e.path||e.name,uploadFields:e.uploadFields||[]},a[t]=e);var r=e,n=r.name,c=r.path,u=r.uploadFields;if(!e.name)throw new Error("name is missing from resource ".concat(e));o[n]=u||[],i[n]=c||n,s[n]={}})),function(){var e=Object(b.a)(f.a.mark((function e(t,r,a){var b,h,v,y,_,S;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c[r];case 2:b=null,e.t0=t,e.next=e.t0===k.d?6:e.t0===k.e?10:e.t0===k.f?14:e.t0===k.g?18:e.t0===k.b?22:e.t0===k.c?27:e.t0===k.h||e.t0===k.a?31:41;break;case 6:return e.next=8,g(a,i[r],s[r]);case 8:return b=e.sent,e.abrupt("return",b);case 10:return e.next=12,m(a,i[r],s[r]);case 12:return b=e.sent,e.abrupt("return",b);case 14:return e.next=16,x(a,i[r],s[r]);case 16:return b=e.sent,e.abrupt("return",b);case 18:return e.next=20,j(a,i[r],s[r]);case 20:return b=e.sent,e.abrupt("return",b);case 22:return h=o[r]?o[r]:[],e.next=25,l(a.id,r,i[r],h);case 25:return b=e.sent,e.abrupt("return",b);case 27:return e.next=29,O(a.ids,i[r],s[r]);case 29:return b=e.sent,e.abrupt("return",b);case 31:return v=p(a,t,r,i[r],s[r]),y=o[r]?o[r].map((function(e){return u(e,a.data,v,r,i[r])})):[],_=s[r][v]||{},e.next=36,Promise.all(y);case 36:return S=e.sent,e.next=39,d(v,a.data,_,r,i[r],w,S,t===k.a,n);case 39:return b=e.sent,e.abrupt("return",b);case 41:return console.error("Undocumented method: ",t),e.abrupt("return",{data:[]});case 43:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}()},L=r(61),R=(r(742),r(188),r(194),r(220),r(743),r(413),r(195)),U=r(746),B=r(196),q=r.n(B),Y=Object(a.forwardRef)((function(e,t){var r=Object(R.a)();return Object(n.jsxs)(U.a,{onClick:function(){return r()},ref:t,children:[Object(n.jsx)(q.a,{})," Logout"]})})),z=function(e){var t,r=e.source,a=e.record,c=void 0===a?{}:a;return Object(n.jsx)("span",{children:(t=c[r],void 0===t?"":new Date(void 0===t?new Date:1e3*t).toLocaleString())})},G=r(104),K=r(379),W=r(380),H=r(109);function J(e){var t=new Date;return t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),"month"===e||t.setMonth(0),Math.round(Number(t.valueOf()/1e3))}var X=function(e,t){if(void 0===e)return"";var r=new Date(void 0===e?new Date:1e3*e),n=r.getFullYear(),a=(1+r.getMonth()).toString();return a=a.length>1?a:"0"+a,"month"===t?r.toLocaleDateString():a+"/"+n},Q=function(e){var t=e.datetype,r=Object(G.a)(),c=Object(a.useState)([]),s=Object(L.a)(c,2),i=s[0],o=s[1],u=Object(a.useState)(!0),d=Object(L.a)(u,2),l=d[0],p=d[1],h=Object(a.useState)(),j=Object(L.a)(h,2),m=j[0],x=j[1];Object(a.useEffect)((function(){r("GET_LIST","notifications",{sort:{field:"report_timestamp",order:"ASC"},pagination:{page:1,perPage:1e7}}).then((function(e){var t=e.data;e.total;o(t),p(!1)})).catch((function(e){x(e),p(!1)}))}),[]);var O=[];if(l)return Object(n.jsx)(K.a,{});if(m)return Object(n.jsx)(W.a,{});var g="";return i.map(function(){var e=Object(b.a)(f.a.mark((function e(r){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i&&0!==i.length){e.next=2;break}return e.abrupt("return");case 2:if(!(r.report_timestamp<J(t))){e.next=4;break}return e.abrupt("return");case 4:n=X(r.report_timestamp,t),g===n?O[O.length-1].Notifications+=1:(O[O.length]={name:n,Notifications:1},g=n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),Object(n.jsx)(H.d,{height:300,width:"99%",children:Object(n.jsxs)(H.b,{data:O,margin:{top:10,right:30,left:30,bottom:0},children:[Object(n.jsx)(H.c,{strokeDasharray:"3 3"}),Object(n.jsx)(H.f,{dataKey:"name"}),Object(n.jsx)(H.g,{}),Object(n.jsx)(H.e,{}),Object(n.jsx)(H.a,{type:"monotone",dataKey:"Notifications",stroke:"#8884d8",fill:"#8884d8"})]})})},V=r(747),Z=r(748),$=r(749),ee=r(688);function te(e){var t=new Date,r=t.getFullYear(),n=(1+t.getMonth()).toString();return n=n.length>1?n:"0"+n,"month"===e?n+"/"+r:r}var re=function(){return Object(n.jsxs)(Z.a,{children:[Object(n.jsx)($.a,{title:"Welcome to the administration"}),Object(n.jsxs)(ee.a,{children:["Number of notifications per day this month (",te("month"),"): "]}),Object(n.jsx)(Q,{datetype:"month"}),Object(n.jsx)("br",{}),Object(n.jsxs)(ee.a,{children:["Number of notifications per day this year (",te("year"),"):"]}),Object(n.jsx)(Q,{datetype:"year"})]})},ne=r(773),ae=r(782),ce=r(774),se=r(780),ie=r(101),oe=r(778),ue=r(769),de=r(689),le=function(e){var t=Object(de.a)((function(e){return e.breakpoints.down("sm")}));return Object(n.jsx)(ne.a,Object(d.a)(Object(d.a)({},e),{},{sort:{field:"report_timestamp",order:"DESC"},children:t?Object(n.jsx)(ae.a,{primaryText:function(e){return e.report_title},secondaryText:function(e){return"".concat(e.report_content," views")},tertiaryText:function(e){return new Date(1e3*e.report_timestamp).toLocaleDateString()},linkType:function(e){return e.canEdit?"edit":"show"}}):Object(n.jsxs)(ce.a,{rowClick:"show",children:[Object(n.jsx)(V.a,{label:"Title",source:"report_title"}),Object(n.jsx)(V.a,{label:"Content",source:"report_content"}),Object(n.jsx)(z,{label:"Date",source:"report_timestamp"}),Object(n.jsx)(V.a,{label:"Sender Name",source:"sender_name"}),Object(n.jsx)(se.a,{label:"Delete"})]})}))},fe=function(e){var t=e.basePath,r=e.data,a=e.resource;return Object(n.jsx)(ie.a,{children:Object(n.jsx)(se.a,{undoable:!1,basePath:t,record:r,resource:a})})},be=function(e){return Object(n.jsx)(oe.a,Object(d.a)(Object(d.a)({actions:Object(n.jsx)(fe,{})},e),{},{children:Object(n.jsxs)(ue.a,{children:[Object(n.jsx)(V.a,{label:"Title",source:"report_title"}),Object(n.jsx)(V.a,{label:"Content",source:"report_content"}),Object(n.jsx)(z,{label:"Date",source:"report_timestamp"})]})}))},pe=r(788),he=r(776),je=r(775),me=r(770),xe=r(779),Oe=function(e){var t=Object(de.a)((function(e){return e.breakpoints.down("sm")}));return Object(n.jsx)(ne.a,Object(d.a)(Object(d.a)({},e),{},{children:t?Object(n.jsx)(ae.a,{primaryText:function(e){return e.user_name},secondaryText:function(e){return"".concat(e.user_email," views")},tertiaryText:function(e){return new Date(1e3*e.created_timestamp).toLocaleDateString()},linkType:function(e){return e.canEdit?"edit":"show"}}):Object(n.jsxs)(ce.a,{rowClick:"show",children:[Object(n.jsx)(V.a,{source:"user_name"}),Object(n.jsx)(pe.a,{source:"user_email"}),Object(n.jsx)(z,{label:"Date",source:"created_timestamp"})]})}))},ge=function(e){var t=e.record;return Object(n.jsxs)("span",{children:["Edit ",t?'"'.concat(t.user_name,'"'):""]})},we=function(e){return Object(n.jsx)(he.a,Object(d.a)(Object(d.a)({title:Object(n.jsx)(ge,{})},e),{},{children:Object(n.jsxs)(je.a,{children:[Object(n.jsx)(me.a,{source:"user_name"}),Object(n.jsx)(me.a,{source:"user_email"}),Object(n.jsx)(me.a,{disabled:!0,hidden:!0,label:"Created",source:"created_timestamp",defaultValue:new Date})]})}))},ve=function(e){return Object(n.jsx)(xe.a,Object(d.a)(Object(d.a)({},e),{},{children:Object(n.jsxs)(je.a,{children:[Object(n.jsx)(me.a,{source:"user_name"}),Object(n.jsx)(me.a,{source:"user_email"}),Object(n.jsx)(me.a,{source:"user_password"})]})}))},ke=(r(785),r(777),r(789),r(787),r(768),r(411)),ye=r.n(ke),_e=r(412),Se=r.n(_e),De={userProfilePath:"/admin/",userAdminProp:"is_admin"},Pe=N({apiKey:"AIzaSyB7g7YOyd8nA3vbt96Xajnv_9BPzbxSqXk",authDomain:"transportationbermuda.firebaseapp.com",databaseURL:"https://transportationbermuda.firebaseio.com",projectId:"transportationbermuda",storageBucket:"transportationbermuda.appspot.com",messagingSenderId:"119896054784",appId:"1:119896054784:web:5591ed16d38fd7fd2bcce5",measurementId:"G-82141WYBBL"},{trackedResources:[{name:"notifications",path:"reports_test"},{name:"app_users",path:"tokens"},{name:"owner_users",path:"users"}]}),Ae=function(){return Object(n.jsxs)(o.a,{title:"TB Admin",dashboard:re,authProvider:m(De),dataProvider:Pe,logoutButton:Y,children:[Object(n.jsx)(u.a,{name:"notifications",options:{label:"Notifications"},list:le,show:be,icon:ye.a}),Object(n.jsx)(u.a,{name:"owner_users",list:Oe,edit:we,create:ve,icon:Se.a})]})},Ie=function(e){e&&e instanceof Function&&r.e(3).then(r.bind(null,793)).then((function(t){var r=t.getCLS,n=t.getFID,a=t.getFCP,c=t.getLCP,s=t.getTTFB;r(e),n(e),a(e),c(e),s(e)}))};i.a.render(Object(n.jsx)(c.a.StrictMode,{children:Object(n.jsx)(Ae,{})}),document.getElementById("root")),Ie()}},[[682,1,2]]]);
//# sourceMappingURL=main.47f81a04.chunk.js.map